<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Fedora Core on Thinkpad X40 Customization HOWTO</title><meta name="generator" content="DocBook XSL Stylesheets V1.69.1" /><meta name="description" content="This is a HOWTO on configuring and customizing Fedora Core 4 for&#10;use on an IBM X40 (I'm told X40 advice also works well for the T40, which is&#10;essentially the same machine with a bigger display). Note: as of 11 October 2006, this FAQ is&#10;no longer actively maintained.  I have upgraded to an X60.&#10;I recommend ThinkWiki for&#10;all your Linux-on-Thinkpad configuration needs." /></head><body><div class="article" lang="en" xml:lang="en"><div class="titlepage"><div><div><h1 class="title"><a id="index"></a>Fedora Core on Thinkpad X40 Customization HOWTO</h1></div><div><div class="author"><h3 class="author"><span class="firstname">Eric</span> <span class="othername">Steven</span> <span class="surname">Raymond</span></h3><div class="affiliation"><span class="orgname"><a href="http://www.catb.org/~esr/" target="_top">Thyrsus Enterprises</a><br /></span></div></div></div><div><div class="revhistory"><table border="1" width="100%" summary="Revision history"><tr><th align="left" valign="top" colspan="3"><b>Revision History</b></th></tr><tr><td align="left">Revision 2.6</td><td align="left">2006-10-11</td><td align="left">esr</td></tr><tr><td align="left" colspan="3">
	 Termination announcement,
       </td></tr><tr><td align="left">Revision 2.5</td><td align="left">2006-04-24</td><td align="left">esr</td></tr><tr><td align="left" colspan="3">
	 More cleanup on software suspend.
       </td></tr><tr><td align="left">Revision 2.4</td><td align="left">2006-03-27</td><td align="left">esr</td></tr><tr><td align="left" colspan="3">
	 Now we know how to make software suspend work.
       </td></tr><tr><td align="left">Revision 2.4</td><td align="left">2006-03-24</td><td align="left">esr</td></tr><tr><td align="left" colspan="3">
          Updated for Fedora Core 5.  Install madwifi the easy way,
          from livna.  Software suspend is somewhat horked.
       </td></tr><tr><td align="left">Revision 2.3</td><td align="left">2005-11-06</td><td align="left">esr</td></tr><tr><td align="left" colspan="3">
          Updated for Fedora Core 4.  Removed the sections on tpb and
          tpctl, as I wasn't using them and ibm-acpi seems to be the 
	  way to go if you want those capabilities.
       </td></tr><tr><td align="left">Revision 2.2</td><td align="left">2005-08-15</td><td align="left">esr</td></tr><tr><td align="left" colspan="3">
          Note the existence of the ACPI-Extras driver.
       </td></tr><tr><td align="left">Revision 2.1</td><td align="left">2005-05-05</td><td align="left">esr</td></tr><tr><td align="left" colspan="3">
          Point to Stephan Müller's FAQ.
       </td></tr><tr><td align="left">Revision 2.0</td><td align="left">2004-10-15</td><td align="left">esr</td></tr><tr><td align="left" colspan="3">
          Update for FC3.
       </td></tr><tr><td align="left">Revision 1.4</td><td align="left">2004-10-4</td><td align="left">esr</td></tr><tr><td align="left" colspan="3">
          Fixing DHCP troubles.
       </td></tr><tr><td align="left">Revision 1.4</td><td align="left">2004-09-18</td><td align="left">esr</td></tr><tr><td align="left" colspan="3">
          ACPI works now.
       </td></tr><tr><td align="left">Revision 1.3</td><td align="left">2004-09-07</td><td align="left">esr</td></tr><tr><td align="left" colspan="3">
          With John Leach's recipe, 2.6.8 partly fixes ACPI.
       </td></tr><tr><td align="left">Revision 1.2</td><td align="left">2004-09-07</td><td align="left">esr</td></tr><tr><td align="left" colspan="3">
          2.6.8 doesn't fix ACPI.
       </td></tr><tr><td align="left">Revision 1.1</td><td align="left">2004-08-06</td><td align="left">esr</td></tr><tr><td align="left" colspan="3">
          Solution to the Suspend problem.
       </td></tr><tr><td align="left">Revision 1.0</td><td align="left">2004-08-05</td><td align="left">esr</td></tr><tr><td align="left" colspan="3">
	 Initial release.  Workaround for screen garbage, setup steps
	 for the Atheros, some discoveries about ACPI. 
       </td></tr></table></div></div><div><div class="abstract"><p class="title"><b>Abstract</b></p><p>This is a HOWTO on configuring and customizing Fedora Core 4 for
use on an IBM X40 (I'm told X40 advice also works well for the T40, which is
essentially the same machine with a bigger display).</p><p><span class="bold"><strong>Note: as of 11 October 2006, this FAQ is
no longer actively maintained.  I have upgraded to an X60.</strong></span>
I recommend <a href="http://www.thinkwiki.org/wiki/ThinkWiki" target="_top">ThinkWiki</a> for
all your Linux-on-Thinkpad configuration needs.</p></div></div></div><hr /></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="#id233722">Summary of recommended fixes for Fedora Core 5 on the X40</a></span></dt><dt><span class="sect1"><a href="#id233772">Most Things Just Work</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id233805">Kernel-level support</a></span></dt></dl></dd><dt><span class="sect1"><a href="#id233824">Things That Don't Work, And How To Fix Them</a></span></dt><dd><dl><dt><span class="sect2"><a href="#id233829">Suspend/resume</a></span></dt><dt><span class="sect2"><a href="#id272180">The on-board wireless hardware</a></span></dt><dt><span class="sect2"><a href="#id272315">The modem</a></span></dt></dl></dd><dt><span class="sect1"><a href="#id272333">Helpful Links</a></span></dt></dl></div><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id233722"></a>Summary of recommended fixes for Fedora Core 5 on the X40</h2></div></div></div><div class="procedure"><ol type="1"><li><p>Add "acpi_sleep=s3_bios" to the kernel options in
<code class="filename">/etc/grub.conf</code> to make suspend/resume using Fn-F4
work.</p></li><li><p>Remove the GNOME power manager package with this command:
</p><pre class="programlisting">
rpm -e gnome-power-manager
</pre><p>
</p></li><li><p>Enable the livna.org repository and do this:

</p><pre class="programlisting">
rpm -ivh http://rpm.livna.org/livna-release-5.rpm
yum install madwifi
</pre><p>

to make your Atheros WiFi hardware work.</p></li></ol></div></div><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id233772"></a>Most Things Just Work</h2></div></div></div><p>Most things just work.  The X display problems in earlier Fedora
Core versions are gone. Sound is good out of the box.</p><p>Hitting the power-off button while Linux is at runlevel 3 or 5
dispatches through
<span class="citerefentry"><span class="refentrytitle">acpid</span>(8)</span>
and runs <span><strong class="command">shutdown -h now</strong></span> as
it should.</p><p>However, note that upgrading your X server from a stock FC5 may
break your X!  This happened with some FC4-era updates as well.  It is
probably a good idea to put "exclude=xorg*" in your yum options and
update X only on major, well-tested releases.</p><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id233805"></a>Kernel-level support</h3></div></div></div><p>There is an <a href="http://ibm-acpi.sourceforge.net/" target="_top">ACPI
Extras driver</a> that ships with 2.6.10 and later kernels; it's
shipped in FC5 as a module.  It provides very comprehensive control of
the hardware features, including Fn keys, Bluetooth enable/disable,
video output switching, docking/undocking and the UltraBay, CMOS
control, LED control, ACPI sounds, and the embedded temperature
sensors.  The X40 is fully supported, lots of other ThinkPad models
are partially supported.</p></div></div><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id233824"></a>Things That Don't Work, And How To Fix Them</h2></div></div></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id233829"></a>Suspend/resume</h3></div></div></div><p>With the kernel-level support in FC5, suspend-to-disk is
triggered by Fn-F4 or by a lid close (the latter may not be obvious
because there's a bit of lag between lid-close and event).  Resume does
bad things to X: one symptom I see is screwed-up backgrounds in xterms.</p><p>The resume problem can be fixed by adding "acpi_sleep=s3_bios"
to the kernel options in <code class="filename">/etc/grub.conf</code> (thanks
to Dax Kelson for this tip).</p><p>You also need to remove GNOME power manager.  The trashed X
display seems to be the result of some bad interaction between it 
and the kernel-level suspend support. 
<a href="https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=186956" target="_top">This
Bugzilla report</a> tells the story.  Here's the recipe for the fix:

</p><pre class="programlisting">
rpm -e gnome-power-manager
</pre><p>
</p><p>Finally, you want lid close to sleep the machine, do this:</p><div class="procedure"><ol type="1"><li><p>Make the file  /etc/acpi/events/lid.conf with
this contents:</p><pre class="programlisting">
event=button/lid
action=/etc/acpi/action/sleep.sh %e
</pre></li><li><p>In the /etc/acpi/actions/sleep.sh file, do this.</p><pre class="programlisting">
#!/bin/bash

echo -n 'mem' &gt;/sys/power/state
</pre><p>save, then</p><pre class="programlisting">
chmod a+x /etc/acpi/actions/sleep.sh
service acpid restart
</pre></li></ol></div></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id272180"></a>The on-board wireless hardware</h3></div></div></div><p>There are three different NICs inside X40s — the Intel
Wireless Pro 2100 (b only), Intel Wireless Pro 2200 (bg), or the
Atheros (abg), You can tell which you have by looking at the output of
<span class="citerefentry"><span class="refentrytitle">lspci</span>(1)</span>.</p><p>I have the Atheros 802.11abg NIC.  It's supported by the <a href="http://sourceforge.net/projects/madwifi/" target="_top">MADWIFI
project</a>. Here are the steps I took to get it working:</p><div class="procedure"><ol type="1"><li><p>Enable the livna.org repository and install the software 
with the following commands:

</p><pre class="programlisting">
rpm -ivh http://rpm.livna.org/livna-release-5.rpm
yum install madwifi
</pre><p>
</p></li><li><p>Type <span><strong class="command">ifconfig -a</strong></span>. You should see an entry for
“<span class="quote">ath0</span>”.  This is your wireless device.</p></li><li><p>
Type <span><strong class="command">ifconfig ath0 up</strong></span> to enable the device.
Then type <span><strong class="command">iwlist ath0 scan</strong></span>.  If you get at least one
cell listing, you are golden — your card has detected an 
active wireless access point.</p></li><li><p>To connect your card to one of the access points, you will
need to issue a command something like this:</p><pre class="programlisting">
iwconfig ath0 mode managed essid XXXXX
</pre><p>where XXXXX is one of the ESSIDs that showed up in your scan.</p></li><li><p>I tripped over some strange bugs or misconfigurations when
trying to get <span class="citerefentry"><span class="refentrytitle">dhclient</span>(1)</span> to grab a DHCP address off my wireless
router.  Eventually I gave up and just did this:</p><pre class="programlisting">
#!/bin/sh
ifconfig eth0 down
modprobe ath_pci
ifconfig ath0 up
iwconfig ath0 mode managed essid belkin54g
ifconfig ath0 192.168.1.13
route add default gw 192.168.1.1
</pre></li></ol></div></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id272315"></a>The modem</h3></div></div></div><p>I have never felt any need to get the on-board modem working; in
this age of ubiquitous WiFi and Ethernet it seems like an evolutionary
vestige.  If you care, a configuration procedure is described <a href="http://www.chronox.de/x40_linux/linux_on_x40.html#configuring_the_modem" target="_top">here</a>.</p></div></div><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id272333"></a>Helpful Links</h2></div></div></div><p>There is a wiki for Linux-on-Thinkpad users: <a href="http://www.thinkwiki.org/wiki/ThinkWiki" target="_top">ThinkWiki</a>.  This
is an excellent resource.</p><p>There is a comprehensive document on configuring the X40 aimed
at Debian and Knoppix users <a href="http://www.chronox.de/x40_linux/linux_on_x40.html" target="_top">here</a>.</p><p>Internally, the X40 is much like a T40.  <a href="http://www.christners.net/rob_elizabeth/ibm_thinkpad_t40p.html" target="_top">This
page</a> helped get me started.</p><p>There is a good general FAQ covering Linux wireless support
<a href="http://www.hpl.hp.com/personal/Jean_Tourrilhes/Linux/" target="_top">here</a>.</p><p>There is an X40 HOWTO for Debian users <a href="http://www.chronox.de/x40_linux/linux_on_x40.html" target="_top">here</a>.
It includes information on making the X40 modem, IrDA, and Bluetooth
hardware work.</p></div></div></body></html>
