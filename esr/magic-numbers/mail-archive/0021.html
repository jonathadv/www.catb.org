<!-- received="Thu Oct 24 02:02:29 1996 EST" -->
<!-- sent="Thu, 24 Oct 1996 02:02:29 -0400 (EDT)" -->
<!-- name="Christos Zoulas" -->
<!-- email="christos@deshaw.com" -->
<!-- subject="RFC first cut -- springboard for discussion" -->
<!-- id="199610231731.NAA28670@sys1.nyc.deshaw.com" -->
<!-- inreplyto="" -->
<title>magic-numbers: RFC first cut -- springboard for discussion</title>
<h1>RFC first cut -- springboard for discussion</h1>
Christos Zoulas (<i>christos@deshaw.com</i>)<br>
<i>Thu, 24 Oct 1996 02:02:29 -0400 (EDT)</i>
<p>
<ul>
<li> <b>Messages sorted by:</b> <a href="date.html#21">[ date ]</a><a href="index.html#21">[ thread ]</a><a href="subject.html#21">[ subject ]</a><a href="author.html#21">[ author ]</a>
<!-- next="start" -->
<li> <b>Next message:</b> <a href="0022.html">Eric S. Raymond: "Re: file types"</a>
<li> <b>Previous message:</b> <a href="0020.html">Christos Zoulas: "First cut at magic-numbers RFC"</a>
<!-- nextthread="start" -->
<li> <b>Next in thread:</b> <a href="0035.html">Greg Roelofs: "Re: RFC first cut -- springboard for discussion"</a>
</ul>
<!-- body="start" -->
INTRODUCTION<br>
<p>
Cross-platform file export through means like public FTP directories has long<br>
been an important mechanism of Internet information sharing.  More recently,<br>
the growth of the Internet has been driven by technologies such as the <br>
World Wide Web, which give it (among other things) the aspect of a single<br>
huge distributed file store.<br>
<p>
In such an environment, it is very desirable that files should<br>
generally present themselves as self-describing objects from which an<br>
application launcher or navigation tool can readily deduce both their<br>
uses and at least some of the semantics of their contents. An<br>
effective set of such conventions can enable tools such as Web<br>
browsers to inform users according to such deductions, and to dispatch<br>
to appropriate sub-interpreters and user agents on the file object's<br>
semantic type.<br>
<p>
The Internet's major operating systems have traditionally shared two<br>
means of ad-hoc semantic typing for files.  The better known is the<br>
quasi-systematic use of file name "extensions" to carry semantic<br>
information (most Internet habitues, for example would feel<br>
justifiably surprised if a file with extension ".gif" were not to<br>
contain picture data in the well-known Graphic Interchange Format).<br>
Standardization of such file name extensions would be a desirable goal,<br>
but is beyond the scope of this RFC.<br>
<p>
The other, prevalent especially under Unix, is the quasi-systematic<br>
use of "magic numbers" in binary-format files.  Many Unix binary <br>
formats have an initial segment of fixed pattern intended to uniquely<br>
identify the file type for the purposes of loaders, linkers, graphics<br>
viewers, and other tools.<br>
<p>
The purpose of this RFC is threefold:<br>
<p>
(1) To enunciate guidelines and design principles appropriate when choosing <br>
    magic numbers for a new file type.<br>
 <br>
(2) To advertise a central Internet registry of "magic numbers" (initially <br>
    based on Unix prior art but intended to be platform-independent), with<br>
    procedures for checking candidate segment patterns against the registry<br>
    and for claiming new patterns.<br>
<p>
(3) To define a new standards-compliance category of MAGIC programs (MAGIC =<br>
    "Magic Against Galloping Internet Complexity") which are required to <br>
    be aware, in certain well-defined ways, of registered magic numbers.<br>
<p>
The goal of encouraging MAGIC compliance is to formalize existing practice in<br>
a way which creates a uniform semantic file type system for the Internet.<br>
<p>
HOW TO PICK MAGIC NUMBERS<br>
<p>
GLOSSARY<br>
<p>
Primary magic:<br>
<p>
  Magic numbers used to identify the type of data stream or file. Any given<br>
  file has only one primary magic block.<br>
<p>
Secondary magic<br>
<p>
  Magic numbers used to identify characteristics of the data stream<br>
  of file such as version, sub-type, etc.  A file may have more than<br>
  one secondary magic block.<br>
<p>
REQUIREMENTS<br>
<p>
The first and third are required for compatibility with both<br>
traditional and POSIX versions of file(1).  To be eligible for<br>
inclusion in the Registry, a new file format MUST have these properties:<br>
<p>
1. The primary and all secondary magic blocks must be located at predictable<br>
   constant offsets from the beginning of the data stream.  (The purpose of<br>
   this requirement is to permit tests for magic to be expressed in the <br>
   simple, rapidly-interpretable notation of file(1)).<br>
<p>
2. The primary and all secondary magic blocks must be located within 512<br>
   bytes of the beginning of the file or stream.  (The purpose of this<br>
   requirement is to limit the amount of data which MAGIC-compliant programs<br>
   must read to determine a file's type.)<br>
<p>
3. Both primary and secondary magic must consist of single, contiguous<br>
   octet-aligned blocks of octets.<br>
<p>
RECOMMENDATIONS<br>
<p>
1. Both primary and secondary magic blocks should be limited to 8 bytes each.<br>
<p>
2. Primary magic blocks should not contain NULs.<br>
<p>
3. Magic should be not composed solely of characters in ASCII, ISO Latin-1,<br>
   or other standard character sets unless the file type is a text format<br>
   with characters limited to that set.<br>
<p>
4. For binary files, magic should be a random mix of text and non-text<br>
   characters, preferably including characters in each of these ranges:<br>
   ASCII, Latin-1 extensions to ASCII, and everything else.<br>
<p>
5. The primary magic should be constant for a particular application or data<br>
   type.  Only secondary magic should change depending on the version of<br>
   an application or data type.<br>
<p>
REGISTRY ATTRIBUTES<br>
<p>
Each registry entry includes the following attributes:<br>
<p>
(1) Recipe<br>
<p>
    This is a pattern, expressed in a recipe notation compatible with<br>
that of Unix file(1), describing the primary and/or secondary magic<br>
numbers and their offsets.<br>
<p>
(2) Contact<br>
<p>
    A Web page or email contact for the person(s) responsible for the<br>
format.<br>
<p>
(3) Status<br>
<p>
    One of: Experimental, Production, or Obsolete.<br>
<p>
(4) Code<br>
<p>
    A code of at most 8 ASCII characters intended for use as a type<br>
representation icon in text-only navigation tools.<br>
<p>
(5) Icons<br>
<p>
    One or more 32x32 PNG icons intended for use as a type representation<br>
icon in graphic navigation tools.<br>
<p>
(5) Class<br>
<p>
    One of a set of semantic-class codes described below.<br>
<p>
(6) Description<br>
<p>
    Text description of the format (in the style of Unix file(1)).<br>
<p>
(7) Resources<br>
<p>
    Zero or more quadruples consisting of<br>
       (a) A name<br>
       (b) A resource type<br>
             Resource types may include Documentation, Viewer, Library, <br>
             Browser, Toolkit, Editor.<br>
       (c) An URL<br>
       (d) Comments<br>
<p>
(8) Timestamp<br>
<p>
    Date of last update.<br>
<p>
(9) Entered By<br>
<p>
    Email address of person responsible for entry.<br>
<p>
(10) Comments<br>
<p>
    Registry maintainer's comments.<br>
<p>
MAGIC COMPLIANCE<br>
<p>
The purpose of MAGIC-compliance is to enable programs such as Web<br>
browsers, Macintosh-style program launchers, etc. to benefit from an<br>
Internet-standard file semantic type system.<br>
<p>
A program may be MAGIC-compliant in one of two ways.  Either the<br>
program itself contains information equivalent to (a subset of) the<br>
magic-number registry, or it is able to reference an external resource<br>
(such as the Unix /usr/lib/magic file or the master Registry itself)<br>
which is presumed to be a snapshot of appropriate portions of the<br>
Registry contents.<br>
<p>
In the former case, a program may describe itself as being conformant<br>
with the particular release version of the registry (i.e "MAGIC 1.00<br>
compliant") abstracted in its code.  In the latter case, it may simply<br>
describe itself as MAGIC-compliant.<br>
<p>
Certain requirements are placed on MAGIC-compliant programs:<br>
<p>
1. A MAGIC-compliant program MUST be able to recognize (automatically<br>
   or on user query) every file type marked Production in its registry<br>
   version.  It SHOULD be able to recognize every Experimental type.<br>
   It MAY recognize every Obsolete type.<br>
<p>
2. A MAGIC-compliant program MUST allow users to see or request<br>
   the Description field of a file's type, once it has been recognized.<br>
<p>
3. A MAGIC-compliant program's interface SHOULD present for each recognized<br>
   file at least one of the  following:<br>
      (a) The type's Code field (recommended for text-only interfaces)<br>
      (b) Text or icon representing the Class field<br>
      (c) Icon from the Icons list (recommended for graphical interfaces).<br>
<p>
REFERENCE CODE<br>
<p>
A documented C library implementing an API for querying the /usr/lib/magic<br>
file will be made available at the Registry site.  This code is freely<br>
reusable, and developers are encouraged to incorporate it as a way of<br>
making their programs minimally MAGIC-compliant.<br>
<p>
Freely redistributable C sources of the MAGIC-compliant Unix utility file(1) <br>
will be made available along with the library.<br>
<p>
<pre>
-- 
	&lt;a href="<a href="http://www.ccil.org/~esr/home.html">http://www.ccil.org/~esr/home.html</a>"&gt;Eric S. Raymond&lt;/a&gt;
</pre>
<!-- body="end" -->
<p>
<ul>
<!-- next="start" -->
<li> <b>Next message:</b> <a href="0022.html">Eric S. Raymond: "Re: file types"</a>
<li> <b>Previous message:</b> <a href="0020.html">Christos Zoulas: "First cut at magic-numbers RFC"</a>
<!-- nextthread="start" -->
<li> <b>Next in thread:</b> <a href="0035.html">Greg Roelofs: "Re: RFC first cut -- springboard for discussion"</a>
</ul>
