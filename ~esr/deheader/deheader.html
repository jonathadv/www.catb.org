<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>deheader</title><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="refentry"><a name="deheader.1"></a><div class="titlepage"></div><div class="refnamediv"><a name="name"></a><h2>Name</h2><p>deheader &#8212; report which includes in C or C++ compiles can be removed</p></div><div class="refsynopsisdiv"><a name="synopsis"></a><h2>Synopsis</h2><div class="cmdsynopsis"><p><code class="command">deheader</code>  [-h ] [-m <em class="replaceable"><code>command</code></em>] [-b <em class="replaceable"><code>builddir</code></em>] [-i <em class="replaceable"><code>pattern</code></em>] [-q ] [-r ] [-v ] [-x <em class="replaceable"><code>pattern</code></em>] [-V ] [<em class="replaceable"><code>file-or-dir</code></em>]</p></div></div><div class="refsect1"><a name="description"></a><h2>DESCRIPTION</h2><p>This tool takes a list of C or C++ sourcefiles and generates a
report on which #includes can be omitted from them; also, what
standard inclusions may be required for portability. The test, for
each foo.c or foo.cc or foo.cpp, is simply whether "rm foo.o; make
foo.o" returns a zero status (but the build command may be
overridden).</p><p>Exception: Under cmake, foo.o is a phony target.  Therefore,
when a "CMakeList.txt" is detected, "make clean" is done rather than
"rm foo.o".</p><p>Optionally, with the <code class="option">-r</code> switch, the
unneeded headers are removed from the sourcefiles.  Don't use
this option unless you have your sourcefiles safely under version
control and can revert!</p><p>If a sourcefile argument is a directory, the report is generated
on all source files beneath it.  Subdirectories beginning with a dot
are assumed to be repository directories for version-control systems
and ignored.  If no arguments are given, the program runs as if the
name of the current directory had been passed to it.</p><p>Inclusions within the scope of #if/#ifdef/#else/#endif
directives are left alone, because trying to reason about potential
combinations of -D and U options would be too complicated and prone to
weird errors. One exception: headers protected only by S_SPLINT_S, the
conditional for blocking scanning by the static analysis tool
<span class="citerefentry"><span class="refentrytitle">splint</span>(1)</span>,
are scanned normally.</p><p>The tool will also emit warnings about duplicate inclusions, and 
inclusions required for portability but not present.</p><p>It is recommended that you arrange to compile with options that
will stop the compiler on warnings when using this tool; otherwise it
will report headers that only declare prototypes and return types
(and thus throw only warnings) as being not required.  Under gcc the
compiler options to accomplish this are -Werror -Wfatal-errors.  If
your makefile follows normal conventions, running with <span class="command"><strong>-m
"make CFLAGS='-Werror -Wfatal-errors' %s" </strong></span> may do the right thing; you
can check this by running with -v -v -v to see what compilation
commands are actually emitted.</p><p>On each test compile, the original sourcefile is moved to a name
with an .orig suffix and restored on interrupt or after processing
with its original timestamp, unless the <code class="option">-r</code> option was
given and headers removed.</p><p> If the -b option is given, it tells the program that generated
.o files live in a file tree parallel to the source tree but rooted
at the specified argument. If the argument is a relative path, it is
interpreted relative to the directory in which deheader is run.</p><p>If the first test compilation from the top-level directory fails,
deheader descends into the subdirectory of the source file and retries
compiling inside there.</p><p>At verbosity level 0, only messages indicating removable headers
are issued.  At verbosity 1, test compilations are timed and progress
indicated with a twirling-baton prompt. At verbosity level 2, you get
verbose progress messages on the analysis.  At verbosity level 3, you
see the output from the make and compilation commands.</p><p>If the -q (--quiet) option flag was not set, the last line of the
output will be a statistical summary.</p><p>Running deheader will leave a lot of binaries in your directory
that were compiled in ways possibly not invoked by your normal build
process.  Running "make clean" afterwards (or the equivalent under
whatever build system you are using) is strongly recommended.</p></div><div class="refsect1"><a name="options"></a><h2>OPTIONS</h2><div class="variablelist"><dl class="variablelist"><dt><span class="term">-h</span></dt><dd><p>Display some help and exit.</p></dd><dt><span class="term">-m</span></dt><dd><p>Set the build command used for test compiles. Defaults to 'make %s'.
A %s in the build command is replaced with the make target. Targetless
builders such as meson can be supported with, e.g. "-m 'ninja -C build'"</p></dd><dt><span class="term">-b</span></dt><dd><p>Set the build directory for object files.</p></dd><dt><span class="term">-i</span></dt><dd><p>Set a pattern for includes to be ignored. 
Takes a Python regular expression.</p></dd><dt><span class="term">-q</span></dt><dd><p>Suppress statistical summary.</p></dd><dt><span class="term">-r</span></dt><dd><p>Remove header inclusions from sourcefiles where they are not required.</p></dd><dt><span class="term">-v</span></dt><dd><p>Set verbosity.</p></dd><dt><span class="term">-x</span></dt><dd><p>Exclude files with names matching the specified Python regexp.</p></dd><dt><span class="term">-V</span></dt><dd><p>Show version of program and exit.</p></dd></dl></div></div><div class="refsect1"><a name="returns"></a><h2>RETURN VALUES</h2><p>Returns 1 if unneeded includes were found, 0 otherwise. Thus,
you can use it for pre-release sanity checking in Makefile.</p></div><div class="refsect1"><a name="bugs"></a><h2>BUGS</h2><p>Very rarely, test-compiling after running with
<code class="option">-r</code> may show that this tool removed some headers that
are actually required for your build. This can happen because
<span class="command"><strong>deheader</strong></span> doesn't know about all the strange things
your build system gets up to, and the problem of analyzing your build
to understand them would be Turing-complete.  Simply revert the
altered files and continue.</p><p>Due to minor variations in system headers, it is possible your
program may not port correctly to other Unix variants after being
deheadered. This is normally not a problem with the portion of the API
specified by POSIX and ANSI C, but may be for headers that are not
standardized or only weakly standardized.  The sockets API
(sys/select.h, sys/sockets.h, and friends such as sys/types.h and
sys.stat.h) is perhaps the most serious trouble
spot. <span class="command"><strong>deheader</strong></span> has an internal table of rules that
heads off the most common problems by suppressing deletion of headers
that are required for portability, but your mileage may vary.</p><p>The dependency scanner does not ignore the text of comments.
This, e.g, a reference to "log10" in a comment will produce a spurious
warning that &lt;math.h&gt;  is required for portability.</p><p>Sufficiently perverse C++ can silently invalidate the brute-force
algorithm this tool uses. Example: if an overloaded function has
different overloads from two different files, removing one may expose
the other, changing runtime semantics without a compile-time warning.
Similarly, removing a later file containing a template specialization
may lead to undefined behavior from a template defined in an earlier
file. Use this with caution near such features, and test carefully.</p></div><div class="refsect1"><a name="author"></a><h2>AUTHOR</h2><p>Eric S. Raymond <code class="email">&lt;<a class="email" href="mailto:esr@snark.thyrsus.com">esr@snark.thyrsus.com</a>&gt;</code>; (home page at <a class="ulink" href="http://www.catb.org/~esr/" target="_top">http://www.catb.org/~esr/</a>).</p></div></div></body></html>
