<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>doclifter</title><meta name="generator" content="DocBook XSL Stylesheets Vsnapshot" /></head><body><div class="refentry"><a id="doclifter.1"></a><div class="titlepage"></div><div class="refnamediv"><a id="name"></a><h2>Name</h2><p>doclifter — translate troff requests into DocBook</p></div><div class="refsynopsisdiv"><a id="synopsis"></a><h2>Synopsis</h2><div class="cmdsynopsis"><p><code class="command">doclifter</code>  [-o <em class="replaceable"><code>output-location</code></em>] [-e <em class="replaceable"><code>output-encoding</code></em>] [-i <em class="replaceable"><code>input-encodings</code></em>] [-h <em class="replaceable"><code>hintfile</code></em>] [-q] [-x] [-v] [-w] [-V] [-D <em class="replaceable"><code>token=type</code></em>] [-I <em class="replaceable"><code>path</code></em>] [-S <em class="replaceable"><code>spoofname</code></em>]  <em class="replaceable"><code>file</code></em>... </p></div></div><div class="refsect1"><a id="idm36"></a><h2>Description</h2><p><span class="command"><strong>doclifter</strong></span>
translates documents written in troff macros to DocBook.  Structural
subsets of the requests in
<span class="citerefentry"><span class="refentrytitle">man</span>(7)</span>,
<span class="citerefentry"><span class="refentrytitle">mdoc</span>(7)</span>,
<span class="citerefentry"><span class="refentrytitle">ms</span>(7)</span>,
<span class="citerefentry"><span class="refentrytitle">me</span>(7)</span>,
<span class="citerefentry"><span class="refentrytitle">mm</span>(7)</span>,
and
<span class="citerefentry"><span class="refentrytitle">troff</span>(1)</span>
are supported.</p><p>The translation brings over all the structure of the original
document at section, subsection, and paragraph level.  Command and C
function synopses are translated into DocBook markup, not just a
verbatim display.  Tables (TBL markup) are translated into DocBook
table markup. PIC diagrams are translated into SVG.  Troff-level
information that might have structural implications is preserved in
XML comments.</p><p>Where possible, font-change macros are translated into
structural markup.  <span class="command"><strong>doclifter</strong></span> recognizes
stereotyped patterns of markup and content (such as the use of italics
in a FILES section to mark filenames) and lifts them.  A means to
edit, add, and save semantic hints about highlighting is supported.</p><p>Some cliches are recognized and lifted to structural markup 
even without highlighting.  Patterns recognized include
such things as URLs, email addresses, man page references, and
C program listings.</p><p>The tag <span class="markup">.in</span> and <span class="markup">.ti</span> requests are
passed through with complaints. They indicate presentation-level
markup that <span class="command"><strong>doclifter</strong></span> cannot translate into 
structure; the output will require hand-fixing.</p><p>The tag <span class="markup">.ta</span> is passed through with a complaint
unless the immediarely following by text lines contains a tab, in
which case the following span of lines containing tabs is lifted to a
table.</p><p>Under some circumstances, <span class="command"><strong>doclifter</strong></span> can even
lift formatted manual pages and the text output produced by
<span class="citerefentry"><span class="refentrytitle">lynx</span>(1)</span>
from HTML.  If it finds no macros in the input, but does find a NAME
section header, it tries to interpret the plain text as a manual page
(skipping boilerplate headers and footers generated by
<span class="citerefentry"><span class="refentrytitle">lynx</span>(1)</span>).
Translations produced in this way will be prone to miss structural
features, but this fallback is good enough for simple man
pages.</p><p><span class="command"><strong>doclifter</strong></span> does not do a perfect job, merely
a surprisingly good one.  Final polish should be applied by a human
being capable of recognizing patterns too subtle for a computer.  But
<span class="command"><strong>doclifter</strong></span> will almost always produce translations
that are good enough to be usable before hand-hacking.</p><p>See the <a class="link" href="#troubleshooting" title="Troubleshooting">Troubleshooting</a>
section for discussion of how to solve document conversion
problems.</p></div><div class="refsect1"><a id="idm81"></a><h2>Options</h2><p>If called without arguments <span class="command"><strong>doclifter</strong></span> acts as
a filter, translating troff source input on standard input to DocBook
markup on standard output.  If called with arguments, each argument
file is translated separately (but hints are retained, see below); the
suffix <code class="filename">.xml</code> is given to the translated output.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">-o</span></dt><dd><p>Set the output location where files will be saved. Defaults to current
working directory.</p></dd><dt><span class="term">-h</span></dt><dd><p>Name a file to which information on semantic hints gathered
during analysis should be written.</p></dd><dt><span class="term">-D</span></dt><dd><p>The <code class="option">-D</code> allows you to post a hint. This may be
useful, for example, if <span class="command"><strong>doclifter</strong></span> is mis-parsing 
a synopsis because it doesn't recognize a token as a command.  This
hint is merged after hints in the input source have been read.</p></dd><dt><span class="term">-I</span></dt><dd><p>The <code class="option">-I</code> option adds its argument to the include
path used when docfilter searches for inclusions.  The include path is
initially just the current directory.</p></dd><dt><span class="term">-S</span></dt><dd><p>Set the filename to be used in error and warning messages. This
is mainly inttended for use by test scripts.</p></dd><dt><span class="term">-e</span></dt><dd><p>The <code class="option">-e</code> allows you to set the output encoding of
the XML and the encoding field to be emitted in its header.  It
defaults to UTF-8.</p></dd><dt><span class="term">-i</span></dt><dd><p>The <code class="option">-i</code> allows you to set a comma-separated list of
encodings to be looked for in the input. The default is
"ISO-8859-1,UTF-8", which should cover almost all cases.</p></dd><dt><span class="term">-q</span></dt><dd><p>Normally, requests that <span class="command"><strong>doclifter</strong></span> could not
interpret (usually because they're presentation-level) are passed
through to XML comments in the output.  The -q option suppresses
this.  It also suppresses listing of macros.  Messages about requests
that are unrecognized or cannot be translated go to standard error
whatever the state of this option.  This option is intended to reduce 
clutter when you believe you have a clean lift of a document and want
to lose the troff legacy.</p></dd><dt><span class="term">-x</span></dt><dd><p>The -x option requests that <span class="command"><strong>doclifter</strong></span>
generate DocBook version 5 compatible xml content, rather than its
default DocBook version 4.4 output. Inclusions and entities
may not be handled correctly with this switch enabled.</p></dd><dt><span class="term">-v</span></dt><dd><p>The -v option makes <span class="command"><strong>doclifter</strong></span>
noisier about what it's doing.  This is mainly useful for debugging.</p></dd><dt><span class="term">-w</span></dt><dd><p>Enable strict portability checking.  Multiple instances of
-w increase the strictness.  See <a class="xref" href="#portability" title="Portability Checking">the section called “Portability Checking”</a>.</p></dd><dt><span class="term">-V</span></dt><dd><p>With this option, the program emits a version message and exits.</p></dd></dl></div></div><div class="refsect1"><a id="idm144"></a><h2>Translation Rules</h2><p>Overall, you can expect that font changes will be turned into
<code class="sgmltag-element">Emphasis</code> macros with a <code class="sgmltag-attribute">Remap</code> attribute taken from the troff font
name.  The basic font names are R, I, B, U, CW, and SM.</p><p>Troff and macro-package special character escapes are mapped into ISO
character entities.</p><p>When <span class="command"><strong>doclifter</strong></span> encounters a
<span class="markup">.so</span> directive, it searches for the file.  If it can
get read access to the file, and open it, and the file consists
entirely of command lines and comments, then it is included.  If any
of these conditions fails, an entity reference for it is
generated.</p><p><span class="command"><strong>doclifter</strong></span> performs special parsing when it
recognizes a display such as is generated by
<span class="markup">.DS/.DE</span>. It repeatedly tries to parse first a
function synopsis, and then plain text off what remains in the
display.  Thus, most inline C function prototypes will be
lifted to structured markup.</p><p>Some notes on specific translations:</p><div class="refsect2"><a id="idm157"></a><h3>Man Translation</h3><p><span class="command"><strong>doclifter</strong></span> does a good job on most man pages,
It knows about the extended
<span class="markup">UR</span>/<span class="markup">UE</span>/<span class="markup">UN</span> and
<span class="markup">URL</span> requests supported under Linux.  If any
<span class="markup">.UR</span> request is present, it will translate these but
not wrap URLs outide them with <code class="sgmltag-element">Ulink</code> tags. It also
knows about the extended <span class="markup">.L</span> (literal) font markup
from Bell Labs Version 8, and its friends.</p><p>The <span class="markup">.TH</span> macro is used to generate a <code class="sgmltag-element">RefMeta</code> section.  If present, the
date/source/manual arguments (see
<span class="citerefentry"><span class="refentrytitle">man</span>(7)</span>)
are wrapped in <code class="sgmltag-element">RefMiscInfo</code> tag
pairs with those class attributes.  Note that
<span class="command"><strong>doclifter</strong></span> does not change the date.</p><p><span class="command"><strong>doclifter</strong></span> performs special parsing when it
recognizes a synopsis section. It repeatedly tries to parse first a
function synopsis, then a command synopsis, and then plain text off
what remains in the section.</p><p>The following man macros are translated into emphasis tags with
a remap attribute: <span class="markup">.B</span>, <span class="markup">.I</span>,
<span class="markup">.L</span>, <span class="markup">.BI</span>, <span class="markup">.BR</span>,
<span class="markup">.BL</span>, <span class="markup">.IB</span>, <span class="markup">.IR</span>,
<span class="markup">.IL</span>, <span class="markup">.RB</span>, <span class="markup">.RI</span>,
<span class="markup">.RL</span>, <span class="markup">.LB</span>, <span class="markup">.LI</span>,
<span class="markup">.LR</span>, <span class="markup">.SB</span>, <span class="markup">.SM</span>.
Some stereotyped patterns involving these macros are recognized and
turned into semantic markup.</p><p>The following macros are translated into paragraph breaks:
<span class="markup">.LP</span>, <span class="markup">.PP</span>, <span class="markup">.P</span>,
<span class="markup">.HP</span>, and the single-argument form
of <span class="markup">.IP</span>.</p><p>The two-argument form of <span class="markup">.IP</span>
is translated either as a <code class="sgmltag-element">VariableList</code> (usually) or <code class="sgmltag-element">ItemizedList</code> (if the tag is the troff bullet
or square character).</p><p>The following macros are translated semantically:
<span class="markup">.SH</span>,<span class="markup">.SS</span>, <span class="markup">.TP</span>,
<span class="markup">.UR</span>, <span class="markup">.UE</span>, <span class="markup">.UN</span>,
<span class="markup">.IX</span>.  A <span class="markup">.UN</span> call just before
<span class="markup">.SH</span> or <span class="markup">.SS</span> sets the ID for the
new section.</p><p>The <span class="markup">\*R</span>, <span class="markup">\*(Tm</span>,
<span class="markup">\*(lq</span>, and <span class="markup">\*(rq</span> symbols are
translated.</p><p>The following (purely presentation-level) macros are ignored:
<span class="markup">.PD</span>,<span class="markup">.DT</span>.</p><p>The <span class="markup">.RS</span>/<span class="markup">.RE</span> macros are
translated differently depending on whether or not they precede
list markup.  When <span class="markup">.RS</span> occurs just before <span class="markup">.TP</span>
or <span class="markup">.IP</span> the result is nested lists. Otherwise, the
<span class="markup">.RS</span>/<span class="markup">.RE</span> pair is translated into a
<code class="sgmltag-element">Blockquote</code> tag-pair.</p><p><span class="markup">.DS</span>/<span class="markup">.DE</span> is not part of the
documented man macro set, but is recognized because it shows up with
some frequency on legacy man pages from older Unixes.  </p><p>Certain extension macros originally defined under Ultrix are
translated structurally, including those that occasionally show up on
the manual pages of Linux and other open-source Unixes.
<span class="markup">.EX</span>/<span class="markup">.EE</span> (and the synonyms
<span class="markup">.Ex</span>/<span class="markup">.Ee</span>),
<span class="markup">.Ds</span>/<span class="markup">.De</span>,  <span class="markup">.NT</span>/<span class="markup">.NE</span>,
<span class="markup">.PN</span>, and <span class="markup">.MS</span> are translated
structurally.</p><p>The following extension macros used by the X distribution are
also recognized and translated structurally: <span class="markup">.FD</span>,
<span class="markup">.FN</span>, <span class="markup">.IN</span>, <span class="markup">.ZN</span>,
<span class="markup">.hN</span>, and <span class="markup">.C{</span>/<span class="markup">.C}</span>
 The <span class="markup">.TA</span> and
<span class="markup">.IN</span> requests are ignored.</p><p>When the man macros are active, any <span class="markup">.Pp</span> macro
definition containing the request <span class="markup">.PP</span> will be
ignored. and all instances of <span class="markup">.Pp</span> replaced with
<span class="markup">.PP</span>.  Similarly, <span class="markup">.Tp</span> will be
replaced with <span class="markup">.TP</span>.  This is the least painful way to
deal with some frequently-encountered stereotyped wrapper definitions
that would otherwise cause serious interpretation problems</p><p>Known problem areas with man translation:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Weird uses of <span class="markup">.TP</span>.
These will sometime generate invalid XML and sometimes result in
a FIXME comment in the generated XML (a warning message will
also go to standard error).</p></li><li class="listitem"><p>It is debatable how the man macros
<span class="markup">.HP</span> and <span class="markup">.IP</span> without tag should be
translated.  We treat them as an ordinary paragraph break. We could
visually simulate a hanging paragraph with list markup, but this would
not be a structural translation.</p></li></ul></div></div><div class="refsect2"><a id="idm274"></a><h3>Pod2man Translation</h3><p><span class="command"><strong>doclifter</strong></span>
recognizes the extension macros produced by
<span class="command"><strong>pod2man</strong></span>
(<span class="markup">.Sh</span>, <span class="markup">.Sp</span>, <span class="markup">.Ip</span>, <span class="markup">.Vb</span>, <span class="markup">.Ve</span>) and translates them
structurally.</p><p>The results of lifting pages produced by
<span class="command"><strong>pod2man</strong></span> should be checked carefully by eyeball,
especially the rendering of command and function
synopses. <span class="command"><strong>Pod2man</strong></span> generates rather perverse markup;
<span class="command"><strong>doclifter</strong></span>'s struggle to untangle it is sometimes in
vain.</p><p>If possible, generate your DocBook from the POD sources.  There
is a <span class="application">pod2docbook</span> module on CPAN that does
this.</p></div><div class="refsect2"><a id="idm290"></a><h3>Tkman Translation</h3><p><span class="command"><strong>doclifter</strong></span> recognizes the extension macros
used by the Tcl/Tk documentation system: <span class="markup">.AP</span>,
<span class="markup">.AS</span>, <span class="markup">.BS</span>, <span class="markup">.BE</span>,
<span class="markup">.CS</span>, <span class="markup">.CE</span>, <span class="markup">.DS</span>,
<span class="markup">.DE</span>, <span class="markup">.SO</span>, <span class="markup">.SE</span>,
<span class="markup">.UL</span>, <span class="markup">.VS</span>, <span class="markup">.VE</span>.  The
<span class="markup">.AP</span>, <span class="markup">.CS</span>, <span class="markup">.CE</span>,
<span class="markup">.SO</span>, <span class="markup">.SE</span>, <span class="markup">.UL</span>,
<span class="markup">.QW</span> and <span class="markup">.PQ</span>
macros are translated structurally.

</p></div><div class="refsect2"><a id="idm315"></a><h3>Mandoc Translation</h3><p><span class="command"><strong>doclifter</strong></span> should be able to do an excellent
job on most
<span class="citerefentry"><span class="refentrytitle">mdoc</span>(7)</span>
pages, because this macro package expresses a lot of semantic
structure.</p><p>Known problems with mandoc translation: All
<span class="markup">.Bd</span>/<span class="markup">.Ed</span> display blocks are
translated as <code class="sgmltag-element">LiteralLayout</code> tag
pairs.</p></div><div class="refsect2"><a id="idm326"></a><h3>Ms Translation</h3><p><span class="command"><strong>doclifter</strong></span> does a good job on most ms pages.
One weak spot to watch out for is the generation of Author and
Affiliation tags.  The heuristics used to mine this information out of
the <span class="markup">.AU</span> section work for authors
who format their names in the way usual for English
(e.g. "M. E. Lesk", "Eric S. Raymond") but are quite brittle.</p><p>For a document to be recognized as containing ms markup, it must
have the extension <code class="filename">.ms</code>.  This avoids problems 
with false positives.</p><p>The <span class="markup">.TL</span>, <span class="markup">.AU</span>,
<span class="markup">.AI</span>, and <span class="markup">.AE</span> macros turn into
article metainformation in the expected way.  The
<span class="markup">.PP</span>, <span class="markup">.LP</span>, <span class="markup">.SH</span>, and
<span class="markup">.NH</span> macros turn into paragraph and section structure.
The tagged form of <span class="markup">.IP</span> is translated either as a
<code class="sgmltag-element">VariableList</code> (usually) or <code class="sgmltag-element">ItemizedList</code> (if the tag is the troff bullet
or square character); the untagged version is treated as an ordinary
paragraph break.</p><p>The <span class="markup">.DS</span>/<span class="markup">.DE</span> pair is translated
to a <code class="sgmltag-element">LiteralLayout</code> tag pair.  The
<span class="markup">.FS</span>/<span class="markup">.FE</span> pair is translated to a
<code class="sgmltag-element">Footnote</code> tag pair.  The
<span class="markup">.QP</span>/<span class="markup">.QS</span>/<span class="markup">.QE</span>
requests define <code class="sgmltag-element">BlockQuotes</code>.</p><p>The <span class="markup">.UL</span> font change is mapped to U.
<span class="markup">.SM</span> and <span class="markup">.LG</span> become numeric plus or
minus size steps suffixed to the <code class="sgmltag-attribute">Remap</code> attribute.</p><p>The <span class="markup">.B1</span> and <span class="markup">.B2</span> box macros are
translated to a <code class="sgmltag-element">Sidebar</code> tag
pair.</p><p>All macros relating to page footers, multicolumn mode, and keeps
are ignored (<span class="markup">.ND</span>, <span class="markup">.DA</span>,
<span class="markup">.1C</span>, <span class="markup">.2C</span>, <span class="markup">.MC</span>,
<span class="markup">.BX</span>, <span class="markup">.KS</span>, <span class="markup">.KE</span>,
<span class="markup">.KF</span>).  The <span class="markup">.R</span>, <span class="markup">.RS</span>,
and <span class="markup">.RE</span> macros are ignored as well.
</p></div><div class="refsect2"><a id="idm378"></a><h3>Me Translation</h3><p>Translation of me documents tends to produce crude results that need
a lot of hand-hacking.  The format has little usable structure, and
documents written in it tend to use a lot of low-level troff macros;
both these properties tend to confuse <span class="command"><strong>doclifter</strong></span>.</p><p>For a document to be recognized as containing me markup, it must
have the extension <code class="filename">.me</code>.  This avoids problems 
with false positives.</p><p>The following macros are translated into paragraph breaks:
<span class="markup">.lp</span>, <span class="markup">.pp</span>.  The <span class="markup">.ip</span>
macro is translated into a <code class="sgmltag-element">VariableList</code>.  The <span class="markup">.bp</span>
macro is translated into an <code class="sgmltag-element">ItemizedList</code>.  The <span class="markup">.np</span>
macro is translated into an <code class="sgmltag-element">OrderedList</code>.</p><p>The b, i, and r fonts are mapped to emphasis tags with B, I, and
R <code class="sgmltag-attribute">Remap</code> attributes.  The
<span class="markup">.rb</span> ("real bold") font is treated the same as
<span class="markup">.b</span>.</p><p><span class="markup">.q(</span>/<span class="markup">.q)</span> is translated
structurally .</p><p>Most other requests are ignored.</p></div><div class="refsect2"><a id="idm401"></a><h3>Mm Translation</h3><p>Memorandum Macros documents translate well, as these macros
carry a lot of structural information.  The translation rules are
tuned for Memorandum or Released Paper styles; information associated
with external-letter style will be preserved in comments.</p><p>For a document to be recognized as containing mm markup, it must
have the extension <code class="filename">.mm</code>.  This avoids problems 
with false positives.</p><p>The following highlight macros are translated int Emphasis tags:
<span class="markup">.B</span>, <span class="markup">.I</span>, <span class="markup">.R</span>,
<span class="markup">.BI</span>, <span class="markup">.BR</span>, <span class="markup">.IB</span>,
<span class="markup">.IR</span>, <span class="markup">.RB</span>, <span class="markup">.RI</span>.
</p><p>The following macros are structurally translated:
<span class="markup">.AE</span>, <span class="markup">.AF</span>, <span class="markup">.AL</span>,
<span class="markup">.RL</span>, <span class="markup">.APP</span>, <span class="markup">.APPSK</span>,
<span class="markup">.AS</span>, <span class="markup">.AT</span>, <span class="markup">.AU</span>,
<span class="markup">.B1</span>, <span class="markup">.B2</span>, <span class="markup">.BE</span>,
<span class="markup">.BL</span>, <span class="markup">.ML</span>, <span class="markup">.BS</span>,
<span class="markup">.BVL</span>, <span class="markup">.VL</span>, <span class="markup">.DE</span>,
<span class="markup">.DL</span> <span class="markup">.DS</span>, <span class="markup">.FE</span>,
<span class="markup">.FS</span>, <span class="markup">.H</span>, <span class="markup">.HU</span>,
<span class="markup">.IA</span>, <span class="markup">.IE</span>, <span class="markup">.IND</span>,
<span class="markup">.LB</span>, <span class="markup">.LC</span>, <span class="markup">.LE</span>,
<span class="markup">.LI</span>, <span class="markup">.P</span>, <span class="markup">.RF</span>,
<span class="markup">.SM</span>, <span class="markup">.TL</span>, <span class="markup">.VERBOFF</span>,
<span class="markup">.VERBON</span>, <span class="markup">.WA</span>, <span class="markup">.WE</span>.

</p><p>The following macros are ignored:</p><p> <span class="markup">.)E</span>, <span class="markup">.1C</span>,
<span class="markup">.2C</span>, <span class="markup">.AST</span>, <span class="markup">.AV</span>,
<span class="markup">.AVL</span>, <span class="markup">.COVER</span>,
<span class="markup">.COVEND</span>, <span class="markup">.EF</span>, <span class="markup">.EH</span>,
<span class="markup">.EDP</span>, <span class="markup">.EPIC</span>, <span class="markup">.FC</span>,
<span class="markup">.FD</span>, <span class="markup">.HC</span>, <span class="markup">.HM</span>,
<span class="markup">.GETR</span>, <span class="markup">.GETST</span>, <span class="markup">.HM</span>,
<span class="markup">.INITI</span>, <span class="markup">.INITR</span>,
<span class="markup">.INDP</span>, <span class="markup">.ISODATE</span>,
<span class="markup">.MT</span>, <span class="markup">.NS</span>, <span class="markup">.ND</span>,
<span class="markup">.OF</span>, <span class="markup">.OH</span>, <span class="markup">.OP</span>,
<span class="markup">.PGFORM</span>, <span class="markup">.PGNH</span>,
<span class="markup">.PE</span>, <span class="markup">.PF</span>, <span class="markup">.PH</span>,
<span class="markup">.RP</span>, <span class="markup">.S</span>, <span class="markup">.SA</span>,
<span class="markup">.SP</span>, <span class="markup">.SG</span>, <span class="markup">.SK</span>,
<span class="markup">.TAB</span>, <span class="markup">.TB</span>, <span class="markup">.TC</span>,
<span class="markup">.VM</span>, <span class="markup">.WC</span>.</p><p>The following macros generate warnings: <span class="markup">.EC</span>,
<span class="markup">.EX</span>, <span class="markup">.GETHN</span>,
<span class="markup">.GETPN</span>, <span class="markup">.GETR</span>,
<span class="markup">.GETST</span>, <span class="markup">.LT</span>, <span class="markup">.LD</span>,
<span class="markup">.LO</span>, <span class="markup">.MOVE</span>, <span class="markup">.MULB</span>,
<span class="markup">.MULN</span>, <span class="markup">.MULE</span>,
<span class="markup">.NCOL</span>, <span class="markup">.nP</span>, <span class="markup">.PIC</span>,
<span class="markup">.RD</span>, <span class="markup">.RS</span>, <span class="markup">.RE</span>, 
<span class="markup">.SETR</span>
</p><p>Pairs of <span class="markup">.DS</span>/<span class="markup">.DE</span> are
interpreted as informal figures.  If an <span class="markup">.FG</span> is
present it becomes a caption element.</p><p> <span class="markup">.BS</span>/<span class="markup">.BE</span> and
<span class="markup">.IA</span>/<span class="markup">.IE</span> pairs are passed through.
The text inside them may need to be deleted or moved.</p><p>The mark argument of <span class="markup">.ML</span> is
ignored; the following list id formatted as a normal <code class="sgmltag-element">ItemizedList</code>.</p><p>The contents of <span class="markup">.DS</span>/<span class="markup">.DE</span> or
<span class="markup">.DF</span>/<span class="markup">.DE</span> gets turned into a <code class="sgmltag-element">Screen</code> display.  Arguments controlling
presentation-level formatting are ignored.</p></div><div class="refsect2"><a id="idm542"></a><h3>Mwww Translation</h3><p>The mwww macros are an
extension to the man macros supported by
<span class="citerefentry"><span class="refentrytitle">groff</span>(1)</span>
for producing web pages.</p><p>The <span class="markup">URL</span>, <span class="markup">FTP</span>,
<span class="markup">MAILTO</span>, <span class="markup">FTP</span>, <span class="markup">IMAGE</span>,
<span class="markup">TAG</span> tags are translated structurally.  The
<span class="markup">HTMLINDEX</span>, <span class="markup">BODYCOLOR</span>,
<span class="markup">BACKGROUND</span>, <span class="markup">HTML</span>, and
<span class="markup">LINE</span> tags are ignored.</p></div><div class="refsect2"><a id="idm560"></a><h3>TBL Translation</h3><p>All structural features of TBL tables are translated, including
both horizontal and vertical spanning with ‘s’ and
‘^’.  The ‘l’, ‘r’, and
‘c’ formats are supported; the ‘n’ column
format is rendered as ‘r’. Line continuations with
<code class="sgmltag-element">T{</code> and <code class="sgmltag-element">T}</code> are handled correctly.  So is
<span class="markup">.TH</span>.</p><p>The <span class="markup">expand</span>, <span class="markup">box</span>,
<span class="markup">doublebox</span>, <span class="markup">allbox</span>,
<span class="markup">center</span>, <span class="markup">left</span>, and
<span class="markup">right</span> options are supported.  The GNU synonyms
<span class="markup">frame</span> and <span class="markup">doubleframe</span> are also
recognized.  But the distinction between single and double rules and
boxes is lost.</p><p>Table continuations (<code class="sgmltag-element">.T&amp;</code>)
are not supported.</p><p>If the first nonempty line of text immediately before a table is
boldfaced, it is interpreted as a title for the table and the table
is generated using a <code class="sgmltag-element">table</code> and
<code class="sgmltag-element">title</code>.  Otherwise the table is
translated with <code class="sgmltag-element">informaltable</code>.</p><p>Most other presentation-level TBL commands are ignored.
The ‘b’ format qualifier is processed, but point size and width 
qualifiers are not.</p></div><div class="refsect2"><a id="idm583"></a><h3>Pic Translation</h3><p>PIC sections are translated to SVG.
<span class="application">doclifter</span> calls out to
<span class="citerefentry"><span class="refentrytitle">pic2plot</span>(1)</span>
to accomplish this; you must have that utility installed for PIC
translation to work.</p></div><div class="refsect2"><a id="idm590"></a><h3>Eqn Translation</h3><p>EQN sections are
filtered into embedded MathML with 
<span class="command"><strong>eqn -TMathML</strong></span> if possible, otherwise passed
through enclosed in <code class="sgmltag-element">LiteralLayout</code> tags.
After a delim statement has been seen, inline eqn delimiters are
translated into an XML processing instruction. Exception: inline
eqn equations consisting of a single character are translated to an
<code class="sgmltag-element">Emphasis</code> with a Role attribute of eqn.</p></div><div class="refsect2"><a id="idm596"></a><h3>Troff Translation</h3><p>The troff translation is meant only to support interpretation of the
macro sets. It is not useful standalone.</p><p>The <span class="markup">.nf</span> and <span class="markup">.fi</span> macros are
interpreted as literal-layout boundaries.  Calls to the
<span class="markup">.so</span> macro either cause inclusion or are translated
into XML entity inclusions (see above).  Calls to the
<span class="markup">.ul</span> and <span class="markup">.cu</span> macros cause following
lines to be wrapped in an <code class="sgmltag-element">Emphasis</code>
tag with a <code class="sgmltag-attribute">Remap</code> attribute of
"U".  Calls to <span class="markup">.ft</span> generate corresponding start or
end emphasis tags.  Calls to <span class="markup">.tr</span> cause character
translation on output. Calls to <span class="markup">.bp</span> generate a
<code class="sgmltag-element">BeginPage</code> tag (in paragraphed text
only). Calls to <span class="markup">.sp</span> generate a paragraph break (in
paragraphed text only).  Calls to <span class="markup">.ti</span> wrap the
following line in a <code class="sgmltag-element">BlockQuote</code>
These are the only troff requests we translate to DocBook.  The rest
of the troff emulation exists because macro packages use it internally
to expand macros into elements that might be structural.</p><p>Requests relating to macro definitions and strings
(<span class="markup">.ds</span>, <span class="markup">.as</span>, <span class="markup">.de</span>,
<span class="markup">.am</span>, <span class="markup">.rm</span>, <span class="markup">.rn</span>,
<span class="markup">.em</span>) are processed and expanded.  The
<span class="markup">.ig</span> macro is also processed.</p><p>Conditional macros (<span class="markup">.if</span>, <span class="markup">.ie</span>,
<span class="markup">.el</span>) are handled.  The built-in conditions o, n, t,
e, and c are evaluated as if for <span class="application">nroff</span> on
page one of a document.  The m, d, and r troff conditionals
are also interpreted. String comparisons are evaluated by straight
textual comparison.  All numeric expressions evaluate to true. </p><p>The extended <span class="application">groff</span> requests
<span class="markup">cc</span>, <span class="markup">c2</span>, 
<span class="markup">ab</span>, <span class="markup">als</span>, <span class="markup">do</span>,
<span class="markup">nop</span>, and <span class="markup">return</span> and
<span class="markup">shift</span> are interpreted. Its <span class="markup">.PSPIC</span>
extension is translated into a <code class="sgmltag-element">MediaObject</code>.</p><p>The <span class="markup">.tm</span> macro writes its arguments to standard
error (with <code class="option">-t</code>).  The <span class="markup">.pm</span> macro
reports on defined macros and strings.  These facilities may aid in
debugging your translation.</p><p>Some troff escape sequences are lifted:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>The \e and \\ escapes become a bare backslash, \. a
period, and \- a bare dash.</p></li><li class="listitem"><p>The troff escapes \^, \`, \' \&amp;, \0, and \| are lifted 
to equivalent ISO special spacing characters.</p></li><li class="listitem"><p>A \ followed by space is translated to an ISO non-breaking 
space entity.</p></li><li class="listitem"><p>A \~ is also translated to an ISO non-breaking space
entity; properly this should be a space that can't be used for a
linebreak but stretches like ordinary whitepace during line
adjustment, but there is no ISO or Unicode entity for
that.</p></li><li class="listitem"><p>The \u and \d half-line motion vertical motion
escapes, when paired, become <span class="markup">Superscript</span> or
<span class="markup">Subscript</span> tags.</p></li><li class="listitem"><p>The \c escape is handled as a line continuation. in
circumstances where that matters (e.g. for
token-pasting).</p></li><li class="listitem"><p>The \f escape for font changes is translated in
various context-dependent ways. First, <span class="command"><strong>doclifter</strong></span>
looks for cliches involving font changes that have semantic meaning,
and lifts to a structural tag.  If it can't do that, it generates an
<code class="sgmltag-element">Emphasis</code> tag.</p></li><li class="listitem"><p>The \m[] extension is translated into a
<code class="sgmltag-element">phrase</code> span with a remap attribute carrying the
color.  Note: Stylesheets typically won't render
this!</p></li><li class="listitem"><p>Some uses of the \o request are translated: pairs with
a letter followed by one of the characters ` ' : ^ o ~ are translated
to combining forms with diacriticals acute, grave, umlaut, circumflex,
ring, and tilde respectively if the corresponding Latin-1 or Latin-2
character exists as an ISO literal.</p></li></ol></div><p>Other escapes than these will yield warnings or errors.</p><p>All other troff requests are ignored but passed through into
XML comments.  A few (such as <span class="markup">.ce</span>) also trigger
a warning message.</p></div></div><div class="refsect1"><a id="portability"></a><h2>Portability Checking</h2><p>When portability checking is enabled,
<span class="command"><strong>doclifter</strong></span> emits portability warnings about markup
which it can handle but which will break various other viewers and
interpreters.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>At level 1, it will warn about constructions that
would break 
<span class="citerefentry"><span class="refentrytitle">man2html</span>(1)</span>,
(the C program distributed with Linux
<span class="citerefentry"><span class="refentrytitle">man</span>(1)</span>,
not the older and much less capable Perl script).  A close derivative of this
code is used in GNOME <span class="application">yelp</span>.  This should
be the minimum level of portability you aim for, and corresponds to what is 
recommended on the 
<span class="citerefentry"><span class="refentrytitle">groff_man</span>(7)</span>
manual page.
</p></li><li class="listitem"><p>At level 2, it will warn about constructions that will
break portability back to the Unix classic tools (including long macro
names and glyph references with \[]).</p></li></ol></div></div><div class="refsect1"><a id="hints"></a><h2>Semantic analysis</h2><p><span class="command"><strong>doclifter</strong></span> keeps two lists of semantic hints
that it picks up from analyzing source documents (especially from
parsing command and function synopses).  The local list includes:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Names of function formal arguments</p></li><li class="listitem"><p>Names of command options</p></li></ul></div><p>Local hints are used to mark up the individual page from 
which they are gathered. The global list includes:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Names of functions</p></li><li class="listitem"><p>Names of commands</p></li><li class="listitem"><p>Names of function return types</p></li></ul></div><p>If <span class="command"><strong>doclifter</strong></span> is applied to multiple files,
the global list is retained in memory.  You can dump a report of
global hints at the end of the run with the <code class="option">-h</code>
option.  The format of the hints is as follows:</p><pre class="programlisting">
 .\" | mark &lt;phrase&gt; as &lt;markup&gt;
</pre><p>where <strong class="userinput"><code>&lt;phrase&gt;</code></strong> is an item of text
and <strong class="userinput"><code>&lt;markup&gt;</code></strong> is the DocBook markup text
it should be wrapped with whenever it appeared either highlighted
or as a word surrounded by whitespace in the source text.</p><p>Hints derived from earlier files are also applied to later ones.
This behavior may be useful when lifting collections of documents that
apply to a function or command library.  What should be more useful is
the fact that a hints file dumped with <code class="option">-h</code> can be one of
the file arguments to <span class="command"><strong>doclifter</strong></span>; the code detects
this special case and does not write XML output for such a file.
Thus, a good procedure for lifting a large library is to generate a 
hints file with a first run, inspect it to delete false positives, and
use it as the first input to a second run.</p><p>It is also possible to include a hints file directly in a troff
sourcefile.  This may be useful if you want to enrich the file by
stages before converting to XML.</p></div><div class="refsect1"><a id="troubleshooting"></a><h2>Troubleshooting</h2><p><span class="command"><strong>doclifter</strong></span> tries to warn about problems that
it can can diagnose but not fix by itself.  When it says
<code class="computeroutput">"look for FIXME"</code>, do that in the
generated XML; the markup around that token may be wrong.</p><p>Occasionally (less than 2% of the time)
<span class="command"><strong>doclifter</strong></span> will produce invalid DocBook markup even
from correct troff markup.  Usually this results from strange
constructions in the source page, or macro calls that are beyond the
ability of <span class="command"><strong>doclifter</strong></span>'s macro processor to get
right.  Here are some things to watch for, and how to fix them:</p><div class="refsect2"><a id="idm727"></a><h3>Malformed command synopses.</h3><p>If you get a
message that says <code class="computeroutput">"command synopsis parse
failed"</code>, try rewriting the synopsis in your manual
page source.  The most common cause of failure is unbalanced []
groupings, a bug that can be very difficult to notice by eyeball.  To
assist with this, the error message includes a token number in
parentheses indicating on which token the parse failed.</p><p>For more information, use the -v option.  This will trigger
a dump telling you what the command synopsis looked like after
preprocessing, and indicate on which token the parse failed (both with
a token number and a caret sign inserted in the dump of the synopsis
tokens).  Try rewriting the synopsis in your manual page source.  The
most common cause of failure is unbalanced [] groupings, a bug that
can be very difficult to notice by eyeball.  To assist with this, the
error token dump tries to insert ‘$’ at the point of the
last nesting-depth increase, but the code that does this is
failure-prone.</p></div><div class="refsect2"><a id="idm732"></a><h3>Confusing macro calls.</h3><p>Some manual page authors replace standard requests (like
<span class="markup">.PP</span>, <span class="markup">.SH</span> and <span class="markup">.TP</span>)
with versions that do different things in <span class="command"><strong>nroff</strong></span> and
<span class="command"><strong>troff</strong></span> environments.  While
<span class="command"><strong>doclifter</strong></span> tries to cope and usually does a good
job, the quirks of [nt]roff are legion and confusing macro calls
sometimes lead to bad XML being generated. A common symptom of such
problems is unclosed <code class="sgmltag-element">Emphasis</code>
tags.</p></div><div class="refsect2"><a id="idm742"></a><h3>Malformed list syntax.</h3><p> The manual-page parser can be confused by <span class="markup">.TP</span>
constructs that have header tags but no following body.  If the XML
produced doesn't validate, and the problem seems to be a misplaced
<code class="sgmltag-element">listitem</code> tag, try using the verbose (-v) option.
This will enable line-numbered warnings that may help you zero in on
the problem.</p></div><div class="refsect2"><a id="idm747"></a><h3>Section nesting problems with SS.</h3><p>The message <code class="computeroutput">"possible section nesting
error"</code> means that the program has seen two adjacent
subsection headers.  In man pages, subsections don't have a depth
argument, so <span class="command"><strong>doclifter</strong></span> cannot be certain how 
subsections should be nested. Any subsection heading between the
indicated line and the beginning of the next top-level section might
be wrong and require correcting by hand.</p></div><div class="refsect2"><a id="idm752"></a><h3>Bad output with no doclifter error message</h3><p>If you're translating a page that uses user-defined macros, and
doclifter fails to complain about it but you get bad output, the first
thing to do is simplify or eliminate the user-defined macros.  Replace
them with stock requests where possible.</p></div></div><div class="refsect1"><a id="improving"></a><h2>Improving Translation Quality</h2><p>There are a few constructions that are a good idea to check by hand
after lifting a page.</p><p>Look near the <code class="sgmltag-element">BlockQuote</code> tags.
The troff temporary indent request (<span class="markup">.ti</span>) is translated
into a <code class="sgmltag-element">BlockQuote</code> wrapper around the
following line.  Sometimes <code class="sgmltag-element">LiteralLayout</code>
or <code class="sgmltag-element">ProgramListing</code> would be a better
translation, but <span class="command"><strong>doclifter</strong></span> has no way to know this.
</p><p>It is not possible to unambiguously detect candidates for
wrapping in a DocBook <code class="sgmltag-element">option</code> tag in running
text. If you care, you'll have to check for these and fix them by
hand.</p></div><div class="refsect1"><a id="idm767"></a><h2>Bugs And Limitations</h2><p>About 3% of man pages will either make this program throw error status
1 or generate invalid XML. In almost all such cases the misbehavior is
triggered by markup bugs in the source that are too severe to be 
coped with.</p><p>Equation number arguments of EQN calls are ignored.</p><p>Semicolon used as a TBL field separator will lead to garbled
tables. The easiest way to fix this is by patching the source.</p><p>The function-synopsis parser is crude (it's not a compiler) and
prone to errors.  Function-synopsis markup should be checked carefully
by a human.</p><p>If a man page has both paragraphed text in a Synopsis section
and also a body section before the Synopis section, bad things will
happen.</p><p>Running text (e.g., explanatory notes) at the end of a Synopsis
section cannot reliably be distinguished from synopsis-syntax
markup. (This problem is AI-complete.)</p><p>Some firewalls put in to cope with common malformations in troff
code mean that the tail end of a span between two
<span class="markup">\f{B,I,U,(CW}</span> or <span class="markup">.ft</span> highlight
changes may not be completely covered by corresponding <code class="sgmltag-element">Emphasis</code> macros if (for example) the span
crosses a boundary between filled and unfilled
(<span class="markup">.nf</span>/<span class="markup">.fi</span>) text.</p><p>The treatment of conditionals relies on the assumption that
conditional macros never generate structural or font-highlight markup
that differs between the if and else branches.  This appears to be
true of all the standard macro packages, but if you roll any of your
own macros you're on your own.</p><p>Macro definitions in a manual page NAME section are not
interpreted.</p><p>Uses of \c for line continuation sometimes are not translated,
leaving the \c in the output XML. The program will print a warning 
when this occurs.</p><p>It is not possible to unambiguously detect candidates for
wrapping in a DocBook <code class="sgmltag-element">option</code> tag in running
text. If you care, you'll have to check for these and fix them by
hand.</p><p>The line numbers in <span class="command"><strong>doclifter</strong></span> error messages
are unreliable in the presence of <span class="markup">.EQ/.EN</span>, 
<span class="markup">.PS/.PE</span>, and quantum fluctuations.</p></div><div class="refsect1"><a id="idm790"></a><h2>Old macro sets</h2><p>There is a conflict between Berkeley ms's documented
<span class="markup">.P1</span> print-header-on-page request and an undocumented
Bell Labs use for displayed program and equation listings.  The
<span class="emphasis"><em>ms</em></span> translator uses the Bell Labs
interpretation when <span class="markup">.P2</span> is present in the document,
and otherwise ignores the request.</p></div><div class="refsect1"><a id="idm796"></a><h2>Return Values</h2><p>On successful completion, the program returns status 0.  
It returns 1 if some file or standard input could not be translated.  
It returns 2 if one of the input sources was a <span class="markup">.so</span> inclusion.
It returns 3 if there is an error in reading or writing files.  
It returns 4 to indicate an internal error.
It returns 5 when aborted by a keyboard interrupt. </p><p>Note that a zero return does not guarantee that the output is
valid DocBook.  It will almost always (as in, more than 98% of cases)
be syntactically valid XML, but in some rare cases fixups by hand may be
necessary to meet the semantics of the DocBook DTD.  Validation
problems are most likely to occur with complicated list markup.</p></div><div class="refsect1"><a id="idm801"></a><h2>Requirements</h2><p>The
<span class="citerefentry"><span class="refentrytitle">pic2plot</span>(1)</span>
utility must be installed in order to translate PIC diagrams to SVG.</p></div><div class="refsect1"><a id="idm807"></a><h2>See Also</h2><p><span class="citerefentry"><span class="refentrytitle">man</span>(7)</span>,
<span class="citerefentry"><span class="refentrytitle">mdoc</span>(7)</span>,
<span class="citerefentry"><span class="refentrytitle">ms</span>(7)</span>,
<span class="citerefentry"><span class="refentrytitle">me</span>(7)</span>,
<span class="citerefentry"><span class="refentrytitle">mm</span>(7)</span>,
<span class="citerefentry"><span class="refentrytitle">mwww</span>(7)</span>,
<span class="citerefentry"><span class="refentrytitle">troff</span>(1)</span>.</p></div><div class="refsect1"><a id="idm831"></a><h2>Author</h2><p>Eric S. Raymond <code class="email">&lt;<a class="email" href="mailto:esr@thyrsus.com">esr@thyrsus.com</a>&gt;</code></p><p>There is a project web page at
<a class="ulink" href="http://www.catb.org/~esr/doclifter/" target="_top">http://www.catb.org/~esr/doclifter/</a>.</p></div></div></body></html>